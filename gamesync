#!/usr/bin/env bash

# shellcheck disable=SC2145
# shellcheck disable=SC2068

set -e -o pipefail

source /usr/local/bin/gamesync-utilities

log "Syncing saves before executing ${@}"

echo "----START OF ENV VARIABLES----"
printenv >> ~/.local/share/gamesync/log.log
echo "----END OF ENV VARIABLES----"

log "Checking if syncthing is running"

for i in {1..10}; do
  # Simulate some work being done
  sleep 1

  # Update the progress dialog with the current value
  log "$((i * 10))"
done

log "Syncthing is up"

set +e +o pipefail

log "executing game!"

eval 'env LD_PRELOAD="${LD_PRELOAD}" "$@"'

log "done!"
